---
milestone: v1.0
audited: 2026-02-26T23:59:00Z
status: gaps_found
scores:
  requirements: 51/56
  phases: 7/8
  integration: 40/42
  flows: 5/6
gaps:
  requirements:
    - id: "SEC-08"
      status: "unsatisfied"
      phase: "Phase 1: Foundation"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "orphaned"
      evidence: "No plan claims SEC-08 in requirements-completed frontmatter. No Phase 1 VERIFICATION.md exists. REQUIREMENTS.md marks [ ] Pending. Strict CSP, contextIsolation, and nodeIntegration settings are likely configured (Electron best practices) but never formally verified."
    - id: "APP-01"
      status: "unsatisfied"
      phase: "Phase 1: Foundation"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "orphaned"
      evidence: "No plan claims APP-01 in requirements-completed frontmatter. No Phase 1 VERIFICATION.md exists. REQUIREMENTS.md marks [ ] Pending. App shell loads from local cache and channel switches are instant DOM swaps — this is architecturally true (React SPA with HashRouter) but never explicitly verified."
    - id: "SEC-12"
      status: "partial"
      phase: "Phase 1: Foundation"
      claimed_by_plans: ["02-05-PLAN.md"]
      completed_by_plans: ["02-05-SUMMARY.md"]
      verification_status: "passed"
      evidence: "Implemented in Phase 2 (plan 02-05) and verified in 02-06-VERIFICATION.md. But REQUIREMENTS.md traceability table still says 'Phase 1: Foundation / Pending' — table is stale. Implementation is complete; only traceability row needs updating."
  integration:
    - from: "client/src/main/ipc/invite.ts"
      to: "server/src/routes.rs"
      issue: "INVITE_VALIDATE calls GET /api/invites/{code} but server has no GET handler at that path — returns 405. Invite validation step always fails silently (catches error, returns { valid: false })."
      affected_requirements: ["SRVR-09"]
      severity: "critical"
    - from: "client/src/renderer/src/hooks/useVoice.ts"
      to: "client/src/renderer/src/voice/VoiceManager.ts"
      issue: "localUserId set to state.serverId (server UUID) instead of authenticated user's pubkey. VoiceManager uses wrong identity for self-participant filtering and speaking detection."
      affected_requirements: ["VOICE-01", "VOICE-03"]
      severity: "high"
  flows:
    - flow: "User joins server via invite"
      breaks_at: "Step 3: INVITE_VALIDATE → GET /api/invites/{code} returns 405"
      affected_requirements: ["SRVR-09"]
tech_debt:
  - phase: 01-foundation
    items:
      - "No Phase 1 VERIFICATION.md — phase was never formally verified"
      - "SEC-08 (strict CSP) unclaimed by any plan"
      - "APP-01 (instant channel switches) unclaimed by any plan"
      - "REQUIREMENTS.md traceability: SEC-12 still listed as Phase 1 Pending, should be Phase 2 Complete"
  - phase: 02-server-management
    items:
      - "6 items flagged for human verification (WS propagation, non-admin access, invite flow, welcome overlay, ban notice, device provisioning)"
  - phase: 03-p2p-networking
    items:
      - "3 items flagged for human verification (cross-network discovery, gossip latency, dev panel interaction)"
  - phase: 04-real-time-chat
    items:
      - "SEC-03 partially satisfied — REST path messages have empty signature bytes (gossip path correctly signs)"
      - "6 items flagged for human verification (real-time delivery, message grouping, mentions, reactions, notifications, presence)"
  - phase: 05-direct-messages
    items:
      - "DM_DELETE_LOCAL is a no-op (comment: 'Future: persist DM messages in local SQLite')"
      - "DM_BLOCK_USER / DM_UNBLOCK_USER IPC handlers exist but not exposed in preload bridge — inaccessible from UI"
      - "4 items flagged for human verification"
  - phase: 06-content-distribution
    items:
      - "server/src/blocks/store.rs: no disk-based verification on get_block (trusts metadata presence)"
      - "3 items flagged for human verification (StorageSettings, ContentPlaceholder reflow, AttachmentCard icons)"
  - phase: 07-media-and-prefetching
    items:
      - "7 items flagged for human verification (inline rendering, placeholders, lightbox, drag-drop, upload progress, status bar, hover prefetch)"
  - phase: 08-voice-channels
    items:
      - "localUserId bug: useVoice.ts line 81 uses state.serverId instead of user pubkey"
      - "5 items flagged for human verification (P2P audio, mute/deafen, speaking glow, PTT, NAT traversal)"
---

# v1.0 Milestone Audit Report

**Milestone:** v1.0 — UNITED Desktop Application
**Audited:** 2026-02-26
**Status:** gaps_found
**Auditor:** Claude (gsd-audit-milestone)

---

## Executive Summary

The v1.0 milestone has 8 phases, all marked complete, covering 56 v1 requirements. **51 of 56 requirements are fully satisfied**, with 2 unsatisfied (orphaned — never claimed by any plan), 1 partial (implemented but traceability stale), and 2 that need traceability updates only. The integration checker found **1 critical break** (invite validation route mismatch) and **1 high-severity bug** (voice localUserId wrong).

---

## Requirements Coverage (3-Source Cross-Reference)

### Satisfied Requirements: 51/56

All requirements in these categories are fully satisfied across all 3 sources:

| Category | Requirements | Status |
|----------|-------------|--------|
| Text Messaging | MSG-01 through MSG-09 | All SATISFIED |
| Direct Messages | DM-01, DM-02, DM-03 | All SATISFIED |
| Media | MEDIA-01 through MEDIA-04 | All SATISFIED |
| Voice | VOICE-01 through VOICE-04 | All SATISFIED |
| Server Management | SRVR-01 through SRVR-08 | All SATISFIED |
| P2P Distribution | P2P-01 through P2P-10 | All SATISFIED |
| Security | SEC-01 through SEC-07, SEC-09 through SEC-11 | All SATISFIED |
| Client App | APP-02 through APP-05 | All SATISFIED |

### Unsatisfied Requirements: 2

#### SEC-08: Electron renderer strict CSP, contextIsolation, nodeIntegration disabled

| Source | Status |
|--------|--------|
| REQUIREMENTS.md | `[ ]` Pending |
| VERIFICATION.md | Phase 1 has no VERIFICATION.md |
| SUMMARY frontmatter | Not listed in any plan summary |

**Analysis:** This requirement is **orphaned** — it was assigned to Phase 1 but no plan ever claimed it. The Electron security configuration is likely in place (contextIsolation and nodeIntegration are Electron defaults when using contextBridge), but it was never explicitly verified. A strict CSP header is less certain.

#### APP-01: App shell loads from local cache; channel switches are instant DOM swaps

| Source | Status |
|--------|--------|
| REQUIREMENTS.md | `[ ]` Pending |
| VERIFICATION.md | Phase 1 has no VERIFICATION.md |
| SUMMARY frontmatter | Not listed in any plan summary |

**Analysis:** This requirement is **orphaned**. The React SPA with HashRouter means channel switches are already instant DOM swaps (no full page reload). Whether the "loads from local cache" aspect (service worker or Electron protocol handler for offline-first) was implemented is unverified.

### Partial Requirements: 1

#### SEC-12: Device provisioning via QR code

| Source | Status |
|--------|--------|
| REQUIREMENTS.md | `[ ]` Pending (stale — says Phase 1) |
| VERIFICATION.md | SATISFIED in Phase 2 (02-06-VERIFICATION.md) |
| SUMMARY frontmatter | Listed in 02-05-SUMMARY.md |

**Analysis:** Fully implemented and verified in Phase 2. The traceability table is stale — still says "Phase 1 / Pending." Should be updated to "Phase 2 / Complete."

### SRVR-09: Invite join flow (integration break)

| Source | Status |
|--------|--------|
| REQUIREMENTS.md | `[x]` Complete |
| VERIFICATION.md | SATISFIED in Phase 2 |
| Integration check | **BROKEN** — client calls `GET /api/invites/{code}` but server has no GET handler |

**Analysis:** The invite validation step uses a non-existent GET endpoint. The server has `POST /api/invite/validate` but the client calls `GET /api/invites/{code}`. This is an integration wiring break — the individual components are implemented but the cross-component path is broken.

---

## Phase Verification Summary

| Phase | VERIFICATION.md | Status | Score | Notes |
|-------|----------------|--------|-------|-------|
| 01 — Foundation | **MISSING** | unverified | — | 6 plans complete but never phase-verified |
| 02 — Server Management | Present | human_needed | 9/9 | 6 human verification items |
| 03 — P2P Networking | Present | human_needed | 4/4 | 3 human verification items |
| 04 — Real-Time Chat | Present | human_needed | 5/5 | 6 human verification items; SEC-03 partial (REST unsigned) |
| 05 — Direct Messages | Present | passed | 4/4 | Gap closure confirmed |
| 06 — Content Distribution | Present | human_needed | 14/14 | 3 human verification items |
| 07 — Media and Prefetching | Present | passed | 19/19 | Clean pass |
| 08 — Voice Channels | Present | passed | 11/11 | localUserId bug found by integration checker |

---

## Integration Check Results

### Cross-Phase Wiring: 40/42 exports connected

**Orphaned exports (2):**
- `DM_BLOCK_USER` / `DM_UNBLOCK_USER` — IPC handlers registered in main process but not exposed in preload bridge. Inaccessible from renderer UI.

### Critical Integration Break

**Invite validation route mismatch:**
- Client `INVITE_VALIDATE` calls `GET /api/invites/{code}` → server returns 405 (no GET handler)
- The catch block returns `{ valid: false }` — every invite code appears invalid
- Fix: Add GET route for invite validation on server, or update client to use existing endpoint

### High-Severity Bug

**Voice `localUserId` set to `serverId`:**
- `useVoice.ts` line 81: `const localUserId = state.serverId || ''`
- Should be `state.publicKey` or equivalent — affects self-participant filtering and speaking detection
- Fix: Replace with authenticated user's pubkey hex

### E2E Flows: 5/6 complete

| Flow | Status |
|------|--------|
| Create identity → auth → join channel → chat | Complete |
| Open DM → key exchange → send encrypted → receive | Complete |
| Attach file → blocks stored → resolve via cascade → inline render | Complete |
| Join voice → WebRTC signaling → P2P audio | Partial (localUserId wrong) |
| Join via invite → see channels → chat | **Broken** (validation 405) |
| Content persists across sessions | Complete |

---

## Tech Debt Summary

| Category | Count |
|----------|-------|
| Missing Phase 1 VERIFICATION.md | 1 |
| Human verification items across all phases | 34 |
| Integration wiring issues | 2 (1 critical, 1 high) |
| Orphaned IPC handlers | 2 |
| REST signing gap (SEC-03) | 1 |
| DM delete local no-op | 1 |
| Stale traceability entries | 2 (SEC-12, SRVR-09 status) |

**Total: 43 items across 8 phases**

---

*Audited: 2026-02-26*
*Auditor: Claude (gsd-audit-milestone)*
