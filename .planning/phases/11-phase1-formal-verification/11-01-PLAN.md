---
phase: 11-phase1-formal-verification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/01-foundation/01-VERIFICATION.md
  - .planning/REQUIREMENTS.md
autonomous: true
requirements:
  - SEC-01
  - SEC-02
  - SEC-09
  - SEC-10
  - SEC-11
  - SRVR-07
must_haves:
  truths:
    - "Phase 1 VERIFICATION.md exists with evidence for all 6 orphaned requirements"
    - "Each requirement has code-level evidence citing specific file paths and line numbers from both server and client"
    - "REQUIREMENTS.md shows [x] for SEC-01, SEC-02, SEC-09, SEC-10, SEC-11, SRVR-07"
    - "REQUIREMENTS.md traceability table shows Phase 11 as Complete for all 6 requirements"
    - "All 56 v1 requirements have formal verification evidence in at least one VERIFICATION.md"
  artifacts:
    - path: ".planning/phases/01-foundation/01-VERIFICATION.md"
      provides: "Formal verification evidence for 6 Phase 1 requirements"
      contains: "SEC-01"
    - path: ".planning/REQUIREMENTS.md"
      provides: "Updated requirement checkboxes and traceability"
      contains: "Phase 11: Phase 1 Formal Verification | Complete"
  key_links:
    - from: ".planning/phases/01-foundation/01-VERIFICATION.md"
      to: "server/src/auth/challenge.rs, server/src/auth/jwt.rs, server/src/auth/totp.rs, server/src/identity/registration.rs, server/src/identity/blob.rs, server/src/identity/rotation.rs, server/src/admin/settings.rs"
      via: "file path and line number citations"
      pattern: "line \\d+"
    - from: ".planning/phases/01-foundation/01-VERIFICATION.md"
      to: "client/src/main/ipc/crypto.ts, client/src/main/ipc/auth.ts, client/src/renderer/src/pages/CreateIdentity.tsx, client/src/renderer/src/components/TotpEnrollment.tsx, client/src/renderer/src/components/ServerSettings.tsx"
      via: "file path and line number citations"
      pattern: "line \\d+"
---

<objective>
Audit Phase 1 implementations for 6 orphaned requirements and create formal verification evidence.

Purpose: The v1.0 Milestone Audit found that 6 requirements (SEC-01, SEC-02, SEC-09, SEC-10, SEC-11, SRVR-07) have complete implementations but lack formal verification because Phase 1 never had a VERIFICATION.md created. Every other phase (2-10) has one. This plan closes that gap by inspecting the codebase for evidence and producing the verification document, then updating REQUIREMENTS.md to reflect completion.

Output: `.planning/phases/01-foundation/01-VERIFICATION.md` and updated `.planning/REQUIREMENTS.md`
</objective>

<execution_context>
@C:/Users/Computer/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Computer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/v1.0-MILESTONE-AUDIT.md
@.planning/phases/11-phase1-formal-verification/11-RESEARCH.md
@.planning/phases/09-milestone-gap-closure/09-VERIFICATION.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit 6 requirements and create Phase 1 VERIFICATION.md</name>
  <files>.planning/phases/01-foundation/01-VERIFICATION.md</files>
  <action>
Inspect the codebase to gather code-level evidence for each of the 6 orphaned requirements. For each requirement, verify at three levels: EXISTS (file/function present), SUBSTANTIVE (not a stub), WIRED (connected to routes/IPC/UI). Produce `.planning/phases/01-foundation/01-VERIFICATION.md` following the exact format established by phases 02-10 (see 09-VERIFICATION.md as reference).

**Evidence gathering for each requirement:**

**SEC-01** (Ed25519 keypair identity with passphrase, 24-word mnemonic, no email/password on server):
- Server: `server/src/identity/registration.rs` — RegisterRequest struct fields (confirm no email/password), public_key acceptance
- Client crypto: `client/src/main/ipc/crypto.ts` — `crypto_sign_keypair` or `crypto_sign_seed_keypair`, Argon2id encryption params, `entropyToMnemonic` from @scure/bip39
- Client UI: `client/src/renderer/src/pages/CreateIdentity.tsx` — passphrase input step, mnemonic display step, mnemonic verification quiz (3-position)
- Wiring: IPC handler registration in preload, route registration in server

**SEC-02** (Challenge-response auth with JWT 15min access + 7-day refresh):
- Server: `server/src/auth/challenge.rs` — `issue_challenge` (POST /api/auth/challenge) and `verify_challenge` (POST /api/auth/verify) with ed25519-dalek signature verification
- Server: `server/src/auth/jwt.rs` — access token expiry (15 min), refresh token expiry (7 days)
- Client: `client/src/main/ipc/auth.ts` — `AUTH_SIGN_CHALLENGE` or similar IPC handler, `signChallenge` using sodium `crypto_sign_detached`
- Wiring: Routes registered in `server/src/routes.rs`, IPC handler registered in preload

**SEC-09** (Encrypted identity blob stored on servers for recovery):
- Server: `server/src/identity/blob.rs` — `get_blob` (GET /api/identity/blob/{fingerprint}), `put_blob` (PUT /api/identity/blob)
- Server: `server/src/identity/registration.rs` — stores encrypted_blob during registration
- Client: `client/src/main/ipc/crypto.ts` — encrypted blob generation
- Wiring: Routes registered in `server/src/routes.rs`

**SEC-10** (TOTP 2FA, RFC 6238 compatible):
- Server: `server/src/auth/totp.rs` — `totp_enroll`, `totp_confirm`, TOTP verification checked during auth verify flow, totp-rs crate
- Client: `client/src/renderer/src/components/TotpEnrollment.tsx` — QR code display via qrcode.react, 6-digit verification input
- Note open question: "enabled by default" means enrollment is prompted after account creation but dismissible (per 01-06 decision). Verify whether TOTP is checked during auth/verify when enrolled.

**SEC-11** (Key rotation with signed records and 72-hour cancellation):
- Server: `server/src/identity/rotation.rs` — `rotate_key` (POST /api/identity/rotate), `cancel_rotation`, dual Ed25519 signature verification, 72-hour cancellation deadline
- Server: `server/src/db/migrations.rs` — rotation_records table with cancellation_deadline column
- Wiring: Routes registered in `server/src/routes.rs`

**SRVR-07** (Server admin configures server name, icon, description):
- Server: `server/src/admin/settings.rs` — `get_server_info` (GET /api/server/info), `update_server_settings` (PUT /api/server/settings)
- Client: `client/src/renderer/src/components/ServerSettings.tsx` — admin panel fields
- Note open question: Check whether icon upload is implemented. If absent, note as caveat (not blocker — core settings CRUD works).
- Wiring: Routes registered in `server/src/routes.rs`, admin panel accessible from ChannelSidebar dropdown

**VERIFICATION.md structure (match 09-VERIFICATION.md format):**
1. YAML frontmatter: phase, verified date, status, score, re_verification
2. Observable Truths table (one per success criterion from ROADMAP Phase 1)
3. Required Artifacts table (files with verification status)
4. Key Link Verification table (from/to/via wiring checks)
5. Requirements Coverage table (6 requirements with SATISFIED status and evidence strings)
6. Anti-Patterns Found section (check for TODOs, stubs in verified files)
7. Human Verification Required section (items needing live runtime testing)
8. Gaps Summary

For the Observable Truths section, use the 8 Phase 1 success criteria from ROADMAP.md but only mark the 6 being verified here. The other 2 (SEC-08, APP-01) were already verified in Phase 9 — reference that.
  </action>
  <verify>
File `.planning/phases/01-foundation/01-VERIFICATION.md` exists. It contains all 6 requirement IDs (SEC-01, SEC-02, SEC-09, SEC-10, SEC-11, SRVR-07) each marked SATISFIED. Every evidence citation references a real file path that exists in the codebase. The format matches the established VERIFICATION.md pattern (YAML frontmatter, Observable Truths table, Required Artifacts, Key Links, Requirements Coverage).
  </verify>
  <done>
01-VERIFICATION.md created with code-level evidence (file paths, line numbers, function names) for all 6 orphaned requirements. Each requirement verified at exists/substantive/wired levels. Format matches phases 02-10 VERIFICATION.md pattern.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update REQUIREMENTS.md checkboxes and traceability</name>
  <files>.planning/REQUIREMENTS.md</files>
  <action>
Update `.planning/REQUIREMENTS.md` to reflect the formal verification of the 6 requirements:

1. **Checkboxes** — Change `[ ]` to `[x]` for each of the 6 requirements:
   - Line with `SEC-01` — change `- [ ] **SEC-01**` to `- [x] **SEC-01**`
   - Line with `SEC-02` — change `- [ ] **SEC-02**` to `- [x] **SEC-02**`
   - Line with `SEC-09` — change `- [ ] **SEC-09**` to `- [x] **SEC-09**`
   - Line with `SEC-10` — change `- [ ] **SEC-10**` to `- [x] **SEC-10**`
   - Line with `SEC-11` — change `- [ ] **SEC-11**` to `- [x] **SEC-11**`
   - Line with `SRVR-07` — change `- [ ] **SRVR-07**` to `- [x] **SRVR-07**`

2. **Traceability table** — Change status from `Pending` to `Complete` for all 6 entries:
   - `SEC-01 | Phase 11: Phase 1 Formal Verification | Pending` → `SEC-01 | Phase 11: Phase 1 Formal Verification | Complete`
   - `SEC-02 | Phase 11: Phase 1 Formal Verification | Pending` → `SEC-02 | Phase 11: Phase 1 Formal Verification | Complete`
   - `SEC-09 | Phase 11: Phase 1 Formal Verification | Pending` → `SEC-09 | Phase 11: Phase 1 Formal Verification | Complete`
   - `SEC-10 | Phase 11: Phase 1 Formal Verification | Pending` → `SEC-10 | Phase 11: Phase 1 Formal Verification | Complete`
   - `SEC-11 | Phase 11: Phase 1 Formal Verification | Pending` → `SEC-11 | Phase 11: Phase 1 Formal Verification | Complete`
   - `SRVR-07 | Phase 11: Phase 1 Formal Verification | Pending` → `SRVR-07 | Phase 11: Phase 1 Formal Verification | Complete`

3. **Update last-updated line** at the bottom of the file to reflect this update.

Do NOT change any other content in the file. Keep the phase attribution as Phase 11 (consistent with Phase 9's pattern where SEC-08 maps to Phase 9, not Phase 1).
  </action>
  <verify>
Grep REQUIREMENTS.md for `[ ] **SEC-01**` — should return 0 matches. Grep for `[x] **SEC-01**` — should return 1 match. Repeat for all 6 requirement IDs. Grep for `Pending` in the traceability table — should return 0 matches. All 56 requirements should show `[x]`.
  </verify>
  <done>
All 6 requirement checkboxes changed from `[ ]` to `[x]`. All 6 traceability entries changed from `Pending` to `Complete`. 56/56 v1 requirements now formally verified.
  </done>
</task>

</tasks>

<verification>
1. `.planning/phases/01-foundation/01-VERIFICATION.md` exists and follows the established format (YAML frontmatter, Observable Truths, Required Artifacts, Key Links, Requirements Coverage, Anti-Patterns, Human Verification, Gaps Summary)
2. All 6 requirements (SEC-01, SEC-02, SEC-09, SEC-10, SEC-11, SRVR-07) appear in the Requirements Coverage table with SATISFIED status
3. Every evidence citation in the VERIFICATION.md references actual file paths that exist in the codebase
4. REQUIREMENTS.md has `[x]` for all 56 v1 requirements (no `[ ]` remaining)
5. REQUIREMENTS.md traceability table has no `Pending` entries remaining
6. The VERIFICATION.md format is consistent with 09-VERIFICATION.md (used as reference)
</verification>

<success_criteria>
- 01-VERIFICATION.md created with code-level evidence for 6 orphaned requirements
- All 6 requirements marked SATISFIED with specific file:line evidence
- Both server (Rust) and client (TypeScript/React) evidence cited for dual-implementation requirements
- REQUIREMENTS.md updated: 56/56 checkboxes marked [x], 0 Pending in traceability
- All 56 v1 requirements now have formal verification evidence across phase VERIFICATION.md files
</success_criteria>

<output>
After completion, create `.planning/phases/11-phase1-formal-verification/11-01-SUMMARY.md`
</output>
